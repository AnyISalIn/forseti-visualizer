{"version":3,"sources":["../../server/services/mysql-db-connection.js"],"names":["MySQLDatabaseConnection","host","user","password","database","initializeConnection","mysql","require","connection","createConnection","connect","err","console","error","stack","on","log","code","sql","callback","query","end"],"mappings":";;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IAEMA,uB;;;AACF,mCAAYC,IAAZ,EAAkBC,IAAlB,EAAwBC,QAAxB,EAAkCC,QAAlC,EAA4C;AAAA;;AACxC,SAAKC,oBAAL,CAA0BJ,IAA1B,EAAgCC,IAAhC,EAAsCC,QAAtC,EAAgDC,QAAhD;AACH;;;;yCAEoBH,I,EAAMC,I,EAAMC,Q,EAAUC,Q,EAAU;AAAA;;AACjD,UAAME,KAAK,GAAGC,OAAO,CAAC,OAAD,CAArB;;AAEA,UAAIC,UAAU,GAAGF,KAAK,CAACG,gBAAN,CAAuB;AACpCR,QAAAA,IAAI,EAAEA,IAD8B;AAEpCC,QAAAA,IAAI,EAAEA,IAF8B;AAGpCC,QAAAA,QAAQ,EAAEA,QAH0B;AAIpCC,QAAAA,QAAQ,EAAEA;AAJ0B,OAAvB,CAAjB;AAOAI,MAAAA,UAAU,CAACE,OAAX,CAAmB,UAAUC,GAAV,EAAe;AAC9B,YAAIA,GAAJ,EAAS;AACLC,UAAAA,OAAO,CAACC,KAAR,CAAc,uBAAuBF,GAAG,CAACG,KAAzC;AACA;AACH;AACJ,OALD;AAOAN,MAAAA,UAAU,CAACO,EAAX,CAAc,OAAd,EAAuB,UAACJ,GAAD,EAAS;AAC5BC,QAAAA,OAAO,CAACI,GAAR,CAAY,UAAZ,EAAwBL,GAAxB;;AACA,YAAIA,GAAG,CAACM,IAAJ,KAAa,0BAAjB,EAA6C;AAAE;AAC3C,UAAA,KAAI,CAACZ,oBAAL,CAA0BJ,IAA1B,EAAgCC,IAAhC,EAAsCC,QAAtC,EAAgDC,QAAhD,EADyC,CACkB;;AAC9D,SAFD,MAEO;AAAE;AACL,gBAAMO,GAAN,CADG,CACQ;AACd;AACJ,OAPD;AASA,WAAKH,UAAL,GAAkBA,UAAlB;AACH;;;0CAEqB;AAClB,aAAO,KAAKA,UAAZ;AACH;AAED;;;;;;;0BAIMU,G,EAAKC,Q,EAAU;AACjB,aAAO,KAAKX,UAAL,CAAgBY,KAAhB,CAAsBF,GAAtB,EAA2BC,QAA3B,CAAP;AACH;;;0BAEK;AACF,WAAKX,UAAL,CAAgBa,GAAhB;AACH;;;;;;eAGUrB,uB","sourcesContent":["// Copyright 2019 Google LLC\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nclass MySQLDatabaseConnection {\n    constructor(host, user, password, database) {\n        this.initializeConnection(host, user, password, database);\n    }\n\n    initializeConnection(host, user, password, database) {\n        const mysql = require('mysql');\n\n        let connection = mysql.createConnection({\n            host: host,\n            user: user,\n            password: password,\n            database: database\n        });\n\n        connection.connect(function (err) {\n            if (err) {\n                console.error('error connecting: ' + err.stack);\n                return;\n            }\n        });\n\n        connection.on('error', (err) => {\n            console.log('db error', err);\n            if (err.code === 'PROTOCOL_CONNECTION_LOST') { // Connection to the MySQL server is usually\n                this.initializeConnection(host, user, password, database); // lost due to either server restart, or a\n            } else { // connnection idle timeout (the wait_timeout\n                throw err; // server variable configures this)\n            }\n        });\n\n        this.connection = connection;\n    }\n\n    getActiveConnection() {\n        return this.connection;\n    }\n\n    /*\n        @param sql - string\n        @param callback - function(error, results, fields) {}\n     */\n    query(sql, callback) {\n        return this.connection.query(sql, callback);\n    }\n\n    end() {\n        this.connection.end();\n    }\n}\n\nexport default MySQLDatabaseConnection;"],"file":"mysql-db-connection.js"}